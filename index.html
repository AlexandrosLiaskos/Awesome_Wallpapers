<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Awesome Wallpapers</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --neon-teal: rgb(0, 255, 200);
            --dark-bg: rgb(10, 20, 20);
        }
        body {
            background-color: var(--dark-bg);
            color: white;
        }
        .neon-text {
            color: var(--neon-teal);
            text-shadow: 0 0 5px var(--neon-teal);
        }
        .neon-border {
            border-color: var(--neon-teal);
            box-shadow: 0 0 5px var(--neon-teal);
        }
        .search-dropdown {
            background-color: rgba(10, 20, 20, 0.95);
            border: 1px solid var(--neon-teal);
        }
        .selected-item {
            background-color: rgba(0, 255, 200, 0.2);
        }
    </style>
</head>
<body>
    <div id="app" class="min-h-screen">
        <!-- Search Bar -->
        <div class="fixed top-0 left-0 right-0 bg-opacity-90 bg-gray-900 p-4 z-50">
            <div class="max-w-4xl mx-auto relative">
                <input 
                    type="text" 
                    v-model="searchQuery"
                    @keydown.down="selectNextResult"
                    @keydown.up="selectPreviousResult"
                    @keydown.enter="selectResult"
                    placeholder="Search by title or use @ for tags..."
                    class="w-full p-2 bg-gray-800 border-2 neon-border rounded-lg focus:outline-none"
                >
                <!-- Search Results Dropdown -->
                <div v-if="showDropdown" class="search-dropdown absolute w-full mt-2 rounded-lg overflow-hidden">
                    <div 
                        v-for="(result, index) in searchResults" 
                        :key="index"
                        @click="selectWallpaper(result)"
                        :class="['p-2 cursor-pointer hover:bg-gray-700', 
                                {'selected-item': index === selectedResultIndex}]"
                    >
                        <div class="font-bold">{{ result.filename }}</div>
                        <div class="text-sm text-gray-400">
                            Tags: {{ result.tags.join(', ') }}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex pt-20">
            <!-- Side Panel -->
            <div class="w-1/3 h-screen overflow-y-auto fixed left-0 p-4 bg-opacity-90 bg-gray-900">
                <div v-for="wallpaper in sortedWallpapers" :key="wallpaper.filename" 
                     class="mb-4 p-4 rounded-lg bg-gray-800 hover:bg-gray-700 cursor-pointer"
                     :class="{'neon-border': selectedWallpaper?.filename === wallpaper.filename}"
                     @click="selectWallpaper(wallpaper)">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold neon-text">{{ wallpaper.filename }}</h3>
                            <div class="text-sm text-gray-400 mt-1">
                                Tags: {{ wallpaper.tags.join(', ') }}
                            </div>
                        </div>
                        <div class="text-sm text-gray-400">
                            {{ wallpaper.metadata.file_size_mb }}MB
                        </div>
                    </div>
                    
                    <div v-if="selectedWallpaper?.filename === wallpaper.filename" 
                         class="mt-4 text-sm text-gray-300">
                        <div class="grid grid-cols-2 gap-2">
                            <div>Resolution:</div>
                            <div>{{ wallpaper.metadata.width }}x{{ wallpaper.metadata.height }}</div>
                            <div>Aspect Ratio:</div>
                            <div>{{ wallpaper.metadata.aspect_ratio }}</div>
                            <div>File Size:</div>
                            <div>{{ wallpaper.metadata.file_size_mb }}MB</div>
                        </div>
                        <a :href="wallpaper.github_raw_url" 
                           target="_blank"
                           class="block mt-4 text-center p-2 rounded-lg neon-border neon-text hover:bg-gray-700">
                            Download Wallpaper
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Preview Panel -->
            <div class="w-2/3 min-h-screen ml-[33.333333%] p-4">
                <div v-if="selectedWallpaper" class="sticky top-24">
                    <img :src="selectedWallpaper.github_raw_url" 
                         :alt="selectedWallpaper.filename"
                         class="w-full rounded-lg shadow-xl">
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, watch } = Vue

        createApp({
            setup() {
                const wallpapers = ref([])
                const selectedWallpaper = ref(null)
                const searchQuery = ref('')
                const selectedResultIndex = ref(0)

                // Load wallpapers data
                fetch('wallpapers_database.json')
                    .then(response => response.json())
                    .then(data => {
                        wallpapers.value = Object.values(data)
                        if (wallpapers.value.length > 0) {
                            selectedWallpaper.value = wallpapers.value[0]
                        }
                    })

                const sortedWallpapers = computed(() => {
                    if (!selectedWallpaper.value) return wallpapers.value

                    return [
                        selectedWallpaper.value,
                        ...wallpapers.value.filter(w => w.filename !== selectedWallpaper.value.filename)
                    ]
                })

                const searchResults = computed(() => {
                    if (!searchQuery.value) return []

                    const query = searchQuery.value.toLowerCase()
                    if (query.startsWith('@')) {
                        const tagQuery = query.slice(1)
                        return wallpapers.value.filter(w => 
                            w.tags.some(tag => tag.toLowerCase().includes(tagQuery))
                        )
                    }

                    return wallpapers.value.filter(w => 
                        w.filename.toLowerCase().includes(query) ||
                        w.tags.some(tag => tag.toLowerCase().includes(query))
                    )
                })

                const showDropdown = computed(() => 
                    searchQuery.value.length > 0 && searchResults.value.length > 0
                )

                const selectWallpaper = (wallpaper) => {
                    selectedWallpaper.value = wallpaper
                    searchQuery.value = ''
                    selectedResultIndex.value = 0
                }

                const selectNextResult = () => {
                    if (selectedResultIndex.value < searchResults.value.length - 1) {
                        selectedResultIndex.value++
                    }
                }

                const selectPreviousResult = () => {
                    if (selectedResultIndex.value > 0) {
                        selectedResultIndex.value--
                    }
                }

                const selectResult = () => {
                    if (searchResults.value.length > 0) {
                        selectWallpaper(searchResults.value[selectedResultIndex.value])
                    }
                }

                watch(searchQuery, () => {
                    selectedResultIndex.value = 0
                })

                return {
                    wallpapers,
                    selectedWallpaper,
                    searchQuery,
                    searchResults,
                    showDropdown,
                    selectedResultIndex,
                    sortedWallpapers,
                    selectWallpaper,
                    selectNextResult,
                    selectPreviousResult,
                    selectResult
                }
            }
        }).mount('#app')
    </script>
</body>
</html>